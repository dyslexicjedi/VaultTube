{% extends "base.html" %}
{% block content %}

<div><h5 id="latestlabel"></h5></div>
<div class="row row-cols-3 row-cols-md-4 g-4" id="carddeck"></div>
<nav aria-label="..." class="pt-4 pb-4">
    <ul id="pagelist" class="pagination"></ul>
</nav>

<script>
const querystring = window.location.search;
const urlparams = new URLSearchParams(querystring);
const creator = urlparams.get('creator');
pagination(1,creator);
$("#latestlabel").val(creator);
function processdata(data){
        $("#carddeck").empty();
        $.each(data,function(i,item){
            var jobj = jQuery.parseJSON(data[i]["json"]);
            var txt = "<div class=\"col\"><div class=\"card h-100\" onclick=\"playvid('"+data[i].id+"')\"><img src=\"/api/images/"+data[i].id+"\" class=\"card-img-top img-fluid\" alt=\"...\"><div class=\"card-body\"><h5 class=\"card-title\">"+jobj["items"][0]["snippet"]["title"]+"</h5>";
            txt += "</div><div class=\"card-footer\"><small class=\"text-muted\">Published: "+data[i].PublishedAt+"</small></div></div></div>";
            $("#carddeck").append(txt);
        });
    }
function playvid(id){
        window.location.href='/player.html?id='+id;
    }
function get_videos(currentpage,creator){
        $.getJSON("/api/creator/"+creator+"/"+(currentpage*40),function(data){
            processdata(data);
        });
    }
function pagination(id,creator){
    //var video_count = get_video_count();
    // Find if Video Count is less than number of pages.
    //ToDO
    //Get Videos
    get_videos(id-1,creator);
    //Set Pagination buttons
    $("#pagelist").empty();
    var txt = "";
    if(id == 1){
        txt += "<li class=\"page-item disabled\"><a class=\"page-link\" href=\"#\">Previous</a></li>";
    }
    else{
        txt += "<li class=\"page-item\"><a class=\"page-link\" href=\"#\" onclick=\"pagination("+(id-1)+");\">Previous</a></li>";
    }
    if(id < 4){
        if(id == 1){
            txt += "<li class=\"page-item active\"><a class=\"page-link\" href=\"#\" onclick=\"pagination(1);\">1</a></li>";
        }
        else{
            txt += "<li class=\"page-item\"><a class=\"page-link\" href=\"#\" onclick=\"pagination(1);\">1</a></li>";
        }
        if(id == 2){
            txt += "<li class=\"page-item active\"><a class=\"page-link\" href=\"#\" onclick=\"pagination(2);\">2</a></li>";
        }
        else{
            txt += "<li class=\"page-item\"><a class=\"page-link\" href=\"#\" onclick=\"pagination(2);\">2</a></li>";
        }
        if(id == 3){
            txt += "<li class=\"page-item active\"><a class=\"page-link\" href=\"#\" onclick=\"pagination(3);\">3</a></li>";
        }
        else{
            txt += "<li class=\"page-item\"><a class=\"page-link\" href=\"#\" onclick=\"pagination(3);\">3</a></li>";
        }
        txt += "<li class=\"page-item\"><a class=\"page-link\" href=\"#\" onclick=\"pagination(4);\">4</a></li>";
        txt += "<li class=\"page-item\"><a class=\"page-link\" href=\"#\" onclick=\"pagination(5);\">5</a></li>";
        txt += "<li class=\"page-item\"><a class=\"page-link\" href=\"#\" onclick=\"pagination("+(id+1)+");\">Next</a></li>";
    }
    else{
        txt += "<li class=\"page-item\"><a class=\"page-link\" href=\"#\" onclick=\"pagination("+(id-2)+");\">"+(id-2)+"</a></li>";
        txt += "<li class=\"page-item\"><a class=\"page-link\" href=\"#\" onclick=\"pagination("+(id-1)+");\">"+(id-1)+"</a></li>";
        txt += "<li class=\"page-item active\"><a class=\"page-link\" href=\"#\" onclick=\"pagination("+id+");\">"+id+"</a></li>";
        txt += "<li class=\"page-item\"><a class=\"page-link\" href=\"#\" onclick=\"pagination("+(id+1)+");\">"+(id+1)+"</a></li>";
        txt += "<li class=\"page-item\"><a class=\"page-link\" href=\"#\" onclick=\"pagination("+(id+2)+");\">"+(id+2)+"</a></li>";
        txt += "<li class=\"page-item\"><a class=\"page-link\" href=\"#\" onclick=\"pagination("+(id+1)+");\">Next</a></li>";
    }
    $("#pagelist").append(txt);
    
}

</script>
{% endblock %}